<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¤©æ°£é å ±</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-sky-400 via-blue-500 to-indigo-600 min-h-screen flex items-center justify-center p-4">

<div class="bg-white/80 backdrop-blur-md rounded-3xl shadow-2xl p-8 w-full max-w-3xl">

<h1 class="text-3xl font-bold text-center mb-6">ğŸŒ¤ å°ç£å¤©æ°£é å ±</h1>

<div class="flex gap-2 mb-4">
<input id="cityInput" type="text"
placeholder="è¼¸å…¥å°ç£ç¸£å¸‚ï¼ˆä¾‹å¦‚ï¼šå°åŒ—ã€é«˜é›„ï¼‰"
class="flex-1 p-3 rounded-xl border">
<button onclick="getWeather()" class="bg-blue-500 text-white px-4 rounded-xl hover:bg-blue-600">
æŸ¥è©¢
</button>
</div>

<button onclick="getLocationWeather()" class="w-full bg-indigo-500 text-white p-3 rounded-xl mb-6 hover:bg-indigo-600">
ğŸ“ ä½¿ç”¨ç›®å‰å®šä½
</button>

<div id="weatherResult" class="text-center"></div>
<div id="forecastResult" class="mt-8 grid grid-cols-2 md:grid-cols-5 gap-4"></div>

</div>

<script>

const API_KEY = "061b566180264283fe4df84ddb7edb12";

/* å°ç£åŸå¸‚å°ç…§è¡¨ */
const cityMap = {
"å°åŒ—":"Taipei","è‡ºåŒ—":"Taipei",
"æ–°åŒ—":"New Taipei","æ¡ƒåœ’":"Taoyuan",
"å°ä¸­":"Taichung","è‡ºä¸­":"Taichung",
"å°å—":"Tainan","è‡ºå—":"Tainan",
"é«˜é›„":"Kaohsiung","åŸºéš†":"Keelung",
"æ–°ç«¹":"Hsinchu","è‹—æ —":"Miaoli",
"å½°åŒ–":"Changhua","å—æŠ•":"Nantou",
"é›²æ—":"Yunlin","å˜‰ç¾©":"Chiayi",
"å±æ±":"Pingtung","å®œè˜­":"Yilan",
"èŠ±è“®":"Hualien","å°æ±":"Taitung",
"è‡ºæ±":"Taitung","æ¾æ¹–":"Penghu",
"é‡‘é–€":"Kinmen","é€£æ±Ÿ":"Lienchiang"
};

function getWeather() {
let city = document.getElementById("cityInput").value.trim();

if (cityMap[city]) {
city = cityMap[city];
}

fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},TW&appid=${API_KEY}&units=metric&lang=zh_tw`)
.then(res => res.json())
.then(data => {
if (data.cod !== 200) {
document.getElementById("weatherResult").innerHTML =
"<p class='text-red-500'>æ‰¾ä¸åˆ°åŸå¸‚</p>";
return;
}
displayWeather(data);
fetchForecast(city);
});
}

function getLocationWeather() {
navigator.geolocation.getCurrentPosition(position => {
const lat = position.coords.latitude;
const lon = position.coords.longitude;
fetchWeatherByCoords(lat, lon);
});
}

function fetchWeatherByCoords(lat, lon) {
fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=zh_tw`)
.then(res => res.json())
.then(data => {
displayWeather(data);
fetchForecastByCoords(lat, lon);
});
}

function displayWeather(data) {
const icon = data.weather[0].icon;

document.getElementById("weatherResult").innerHTML = `
<h2 class="text-2xl font-semibold">${data.name}</h2>
<img src="https://openweathermap.org/img/wn/${icon}@2x.png" class="mx-auto">
<p class="text-6xl font-bold my-4">${data.main.temp}Â°C</p>
<p class="text-xl">${data.weather[0].description}</p>
<p class="mt-2 text-gray-600">
æ¿•åº¦ï¼š${data.main.humidity}% ï½œ é¢¨é€Ÿï¼š${data.wind.speed} m/s
</p>
`;
}

function fetchForecast(city) {
fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city},TW&appid=${API_KEY}&units=metric&lang=zh_tw`)
.then(res => res.json())
.then(data => displayForecast(data));
}

function fetchForecastByCoords(lat, lon) {
fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=zh_tw`)
.then(res => res.json())
.then(data => displayForecast(data));
}

function displayForecast(data) {

let dailyData = {};
data.list.forEach(item => {
let date = item.dt_txt.split(" ")[0];
if (!dailyData[date] && item.dt_txt.includes("12:00:00")) {
dailyData[date] = item;
}
});

let forecastHTML = "";

Object.keys(dailyData).slice(0,5).forEach(date => {
let item = dailyData[date];
let d = new Date(date);
let formattedDate = `${d.getMonth()+1}/${d.getDate()}`;
let icon = item.weather[0].icon;

forecastHTML += `
<div class="bg-white rounded-2xl shadow p-4 text-center hover:scale-105 transition">
<p class="font-semibold">${formattedDate}</p>
<img src="https://openweathermap.org/img/wn/${icon}.png" class="mx-auto">
<p class="text-lg font-bold">${item.main.temp}Â°C</p>
<p class="text-sm">${item.weather[0].description}</p>
</div>
`;
});

document.getElementById("forecastResult").innerHTML = forecastHTML;
}

</script>

</body>

</html>
